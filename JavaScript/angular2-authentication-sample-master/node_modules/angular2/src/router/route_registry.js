"use strict";
Object.defineProperties(module.exports, {
  RouteRegistry: {get: function() {
      return RouteRegistry;
    }},
  __esModule: {value: true}
});
var $__route_95_recognizer__,
    $__instruction__,
    $__angular2_47_src_47_facade_47_collection__,
    $__angular2_47_src_47_facade_47_lang__,
    $__route_95_config__,
    $__angular2_47_src_47_reflection_47_reflection__;
var RouteRecognizer = ($__route_95_recognizer__ = require("./route_recognizer"), $__route_95_recognizer__ && $__route_95_recognizer__.__esModule && $__route_95_recognizer__ || {default: $__route_95_recognizer__}).RouteRecognizer;
var $__1 = ($__instruction__ = require("./instruction"), $__instruction__ && $__instruction__.__esModule && $__instruction__ || {default: $__instruction__}),
    Instruction = $__1.Instruction,
    noopInstruction = $__1.noopInstruction;
var $__2 = ($__angular2_47_src_47_facade_47_collection__ = require("angular2/src/facade/collection"), $__angular2_47_src_47_facade_47_collection__ && $__angular2_47_src_47_facade_47_collection__.__esModule && $__angular2_47_src_47_facade_47_collection__ || {default: $__angular2_47_src_47_facade_47_collection__}),
    List = $__2.List,
    ListWrapper = $__2.ListWrapper,
    Map = $__2.Map,
    MapWrapper = $__2.MapWrapper,
    StringMap = $__2.StringMap,
    StringMapWrapper = $__2.StringMapWrapper;
var $__3 = ($__angular2_47_src_47_facade_47_lang__ = require("angular2/src/facade/lang"), $__angular2_47_src_47_facade_47_lang__ && $__angular2_47_src_47_facade_47_lang__.__esModule && $__angular2_47_src_47_facade_47_lang__ || {default: $__angular2_47_src_47_facade_47_lang__}),
    isPresent = $__3.isPresent,
    isBlank = $__3.isBlank,
    isType = $__3.isType,
    StringWrapper = $__3.StringWrapper;
var RouteConfig = ($__route_95_config__ = require("./route_config"), $__route_95_config__ && $__route_95_config__.__esModule && $__route_95_config__ || {default: $__route_95_config__}).RouteConfig;
var reflector = ($__angular2_47_src_47_reflection_47_reflection__ = require("angular2/src/reflection/reflection"), $__angular2_47_src_47_reflection_47_reflection__ && $__angular2_47_src_47_reflection_47_reflection__.__esModule && $__angular2_47_src_47_reflection_47_reflection__ || {default: $__angular2_47_src_47_reflection_47_reflection__}).reflector;
var RouteRegistry = function RouteRegistry() {
  this._rules = MapWrapper.create();
};
($traceurRuntime.createClass)(RouteRegistry, {
  config: function(parentComponent, path, component) {
    var alias = arguments[3] !== (void 0) ? arguments[3] : null;
    if (parentComponent === 'app') {
      parentComponent = '/';
    }
    var recognizer;
    if (MapWrapper.contains(this._rules, parentComponent)) {
      recognizer = MapWrapper.get(this._rules, parentComponent);
    } else {
      recognizer = new RouteRecognizer();
      MapWrapper.set(this._rules, parentComponent, recognizer);
    }
    this._configFromComponent(component);
    var components = StringMapWrapper.create();
    StringMapWrapper.set(components, 'default', component);
    var handler = StringMapWrapper.create();
    StringMapWrapper.set(handler, 'components', components);
    recognizer.addConfig(path, handler, alias);
  },
  _configFromComponent: function(component) {
    if (!isType(component)) {
      return ;
    }
    if (MapWrapper.contains(this._rules, component)) {
      return ;
    }
    var annotations = reflector.annotations(component);
    if (isPresent(annotations)) {
      for (var i = 0; i < annotations.length; i++) {
        var annotation = annotations[i];
        if (annotation instanceof RouteConfig) {
          this.config(component, annotation.path, annotation.component);
        }
      }
    }
  },
  recognize: function(url) {
    var parentComponent = arguments[1] !== (void 0) ? arguments[1] : '/';
    var $__6 = this;
    var componentRecognizer = MapWrapper.get(this._rules, parentComponent);
    if (isBlank(componentRecognizer)) {
      return null;
    }
    var solutions = componentRecognizer.recognize(url);
    for (var i = 0; i < solutions.length; i++) {
      var candidate = solutions[i];
      if (candidate['unmatchedUrl'].length == 0) {
        return handlerToLeafInstructions(candidate, parentComponent);
      }
      var children = StringMapWrapper.create(),
          allMapped = true;
      StringMapWrapper.forEach(candidate['handler']['components'], (function(component, name) {
        if (!allMapped) {
          return ;
        }
        var childInstruction = $__6.recognize(candidate['unmatchedUrl'], component);
        if (isPresent(childInstruction)) {
          childInstruction.params = candidate['params'];
          children[name] = childInstruction;
        } else {
          allMapped = false;
        }
      }));
      if (allMapped) {
        return new Instruction({
          component: parentComponent,
          children: children,
          matchedUrl: candidate['matchedUrl']
        });
      }
    }
    return null;
  },
  generate: function(name, params) {
    var componentRecognizer = MapWrapper.get(this._rules, '/');
    if (isPresent(componentRecognizer)) {
      return componentRecognizer.generate(name, params);
    }
  }
}, {});
Object.defineProperty(RouteRegistry.prototype.config, "parameters", {get: function() {
    return [[], [$traceurRuntime.type.string], [$traceurRuntime.type.any], [$traceurRuntime.type.string]];
  }});
Object.defineProperty(RouteRegistry.prototype.recognize, "parameters", {get: function() {
    return [[$traceurRuntime.type.string], []];
  }});
Object.defineProperty(RouteRegistry.prototype.generate, "parameters", {get: function() {
    return [[$traceurRuntime.type.string], [$traceurRuntime.type.any]];
  }});
function handlerToLeafInstructions(context, parentComponent) {
  var children = StringMapWrapper.create();
  StringMapWrapper.forEach(context['handler']['components'], (function(component, outletName) {
    children[outletName] = new Instruction({
      component: component,
      params: context['params']
    });
  }));
  return new Instruction({
    component: parentComponent,
    children: children,
    matchedUrl: context['matchedUrl']
  });
}
//# sourceMappingURL=route_registry.js.map

//# sourceMappingURL=./route_registry.map